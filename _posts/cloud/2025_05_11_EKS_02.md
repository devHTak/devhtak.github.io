### Chap03. 쿠버네티스에서 애플리케이션을 동작시키는 구조

#### 컨테이너를 동작시키기 위한 리소스
- 파드
  - 파드는 서로 관련성 있는 하나 이상의 컨테이너를 합쳐놓은 오브젝트
  - nginx 컨테이너 단독 구성
    ```
    apiVersion: v1
    kind: Pod
    metadata:
      name: nginx-pod
      labels:
        app: nginx-app
    spec:
      continers:
      - name: nginx-container
        image: nginx
        ports:
        - containerPort: 80
    ```
    - apiVersion: 매니페스트 파일에저 정의된 오브젝트가 준수해야 하는 사양의 버전 설정
    - kind는 매니페스트 파일의 오브젝트 종류를 정의한다
    - metadata: 파드 메타데이터 정의
    - spec.containers: 파드에 생성할 컨테이너 정의로 복수형으로 여러 배열을 설정하며 '-' 으로 시작한다
  - 쿠버네티스의 레이블(metadata.labels)
    - 쿠버네티스에서 디플로이먼트나 서비스 같은 다양한 리소스를 식별하기 위해 레이블 사용
    - 리소스들이 대상으로 하는 파드를 특정 짓기 위해 레이블을 이용하는 것
  - 컨테이너 여러 개를 포함한 파드
    - 컨테이너 여러 개가 모여 하나의 통합된 서비스를 제공하는 경우로 특징은 다음과 같다
      - 로컬 호스트로 서로 통신 가능하고 스토리지(볼륨) 공유 가능하다
    - 사이드카 패턴 (메인 컨테이너 옆에 보조 역할을 하는 컨테이너를 배치하는 구성)
    - 앰버서더 패턴(파드 외부와의 통신 구조 사이에 프록시가 배치되어 통신에 대한 보조적인 역할을 하는 구성)
- 파드의 다중화, 버전 업데이트, 롤백을 구현하는 디플로이먼트
  ```
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: backend-app
    labels:
      app: backend-app
  spec:
    replicas: 2
    selector:
      matchLabels:
        app: backend-app
    template:
      metadata:
        labels:
          app: backend-app
      spec:
        containers:
        - name: backend-app
          image: -
          imagePullPolicy: Always
          ports:
          - containerPort: 8080
          env:
          - name: DB_URL
            valueFrom:
          readinessProbe:
            // ..
          livenessProbe:
            // ..
          resources:
            // ..
          lifecycle:
            // ..
  ```
  - 애플리케이션을 배포할 때 파드를 직접 배포하지 않고 디플로이먼트라는 오브젝트를 만들어 간접적으로 파드를 배포한다
  - 요청량과 처리 부하에 따라 파드 수를 늘리고 줄이면서 대응하는 데, 디플로이먼트를 이용하면 자동으로 해준다.
  - 디플로이먼트 목록 표시
    ```
    kubectl get deployment
    NAME  READY  UP-TO-DATE  AVAILABLE  AGE
    ```
    - UP-TO-DATE 는 디플로이먼트에서 정의된 상태를 만족하는 파드 수
    - AVAILABLE에는 실제 사용가능한 파드 수
    - AGE에는 디플로이먼트가 생성된 이후의 경과 시간
- 디플로이먼트 하위에서 생성되는 레플리카셋
  - 레플리카셋을 통해 파드 수 증감과 파드 장애 시 자동 재시작을 하는 역할을 한다.
  - 레플리카셋으로 생성된 파드
    - replicaset name : deployment_name-난수
    - pod name: replicaset_name-난수 이런 형태로 동일한 디플로이먼트와 레플리카셋으로 생성된 파드인 것을 알 수 있다.
- kubectl describe 명령으로 상세 정보 수집
  - kubectl get object
    - 뒤에 설정한 오브젝트(리소스)에 대한 목록을 보여주며 시점의 상태, 생성 이후 경과 시간 및 기본적인 정보를 표시
  - kubectl describe object object_name
    - 생성된 오브젝트의 상세 정보 내용을 보여준다.
- 크론잡으로 스케줄 동작
  - 배치 애플리케이션에서 사용하며 시작 간격 또는 시간 간격을 설정하여 프로그램을 동작시키기 위한 구조
  - 크론잡을 동작시키는 대상은 컨테이너
  ```
  apiVersion: batch/v1
  kind: CronJob
  metadata:
    name: batch-app
  spec:
    schedule: "*/5 * * * *" # min hour day-of-month month day-of-week
    jobTemplate:
      spec:
        template:
          spec:
            containers:
            - name:
  // ...
  ```
  - spec.jobTemplate: 크론잡의 스케줄별로 실행할 컨테이너 정의로 컨테이너 이름, 이미지, 환경 변수의 갑의 저장소
- 크론잡에서의 실행 내용
  - 쿠버네티스 클러스터에 등록한 경우 설정한 실행 시각이 되면 내부적으로 Job이라는 리소스가 생성되고 Job 안에 파드가 생성된다.
  - Job Resource
    - 일정한 처리를 수행하고 완료하는 태스크를 실행하기 위한 것으로 잡 -> 파드라는 흐름은 일정한 처리가 끝나면 프로그램을 종료하고 태스크도 완료 상태가 되기를 원하는 경우에 사용
- 잡 리소스 동작
  - 
- 크론잡 고유의 설정과 유의점
- 컨테이너를 동작시키기 위한 기타 리소스
- 네임스페이스
#### 컨테이너를 외부로 공개하기 위한 리소스
#### 설정 정보 등을 안전하게 저장하는 구조
#### 파드를 안전하게 외부로 공개하기 위한 헬스 체크
#### 파드를 안전하게 종료하기 위한 고려해야 할 사항
#### 리소스 관리
