### 서비스 환경에 대한 고려

#### 모니터링
- 클러스터 상태 파악
  - EKS 컨트롤 플레인은 AWS를 통해 운영되는 관리형 서비스
  - 데이터 플레인을 EC2로 구축하는 경우 노드를 스스로 관리해야 한다.
    - AWS 오토스케일링 기능을 사용하여 데이터 플레인을 구축하고 최소 서버 대수를 설정하면 그 아래로 떨어지지 않도록 AWS를 자동으로 관리한다
  - 데이터 플레인 부하상태는 Amazon CloudWatch로 확인할 수 있다.
- CloudWatch의 Container Insights로 애플리케이션 상태 파악
  - Container Insights 기능을 이용하면 클러스터 노드, 파드, 네임스페이스 서비스 레벨의 메트릭을 참조할 수 있다.
    - 노드별로 CloudWatch 에이전트를 데몬셋으로 동작시킨 후 필요한 메트릭을 CloudWatch로 전송
  - 데이터 노드의 IAM 역할에 정책 추가
    - AWA Amazon EC2를 선택해 접속
    - 인스턴스 메뉴를 선택한 후 데이터 노드에 해당하는 인스턴스 ID를 클릭하고 상세 정보 페이지에 IAM 역할 아래 링크 클릭
    - IAM 역할에 정책 연결 버튼 클릭
    - 정책 이름 목록에서 CloudWatchAgentServerPolicy를 선택하여 정책연결 클릭
  - CloudWatch 용 네임스페이스 생성
  - CloudWatch 용 서비스 계정 생성
    - 에이전트 파드가 사용할 서비스 계정 생성 필요
  - CloudWatch 에이전트가 사용할 컨피그맵 생성
    - 에이전트 파드는 컨피그맵을 사용해 각종 설정을 불러오기 때문에 컨피그맵 생성 필요
  - CloudWatch 에이전트를 데몬셋으로 동작시키기
  - Container Insights 에서 수집한 메트릭 확인
- CloudWatch 경보를 이용한 통지
  - 메트릭값에 임계값을 설정하여 Alarm을 생성할 수 있고, 특정 조건으로 통지할 수 있다.

#### 로그 관리와 운영
- 로그 관리 및 운영을 위한 기본 개념
  - 수집: Fluentd 컨테이너를 데몬셋으로 동작시키고 파드의 로그를 CloudWatch Logs에 전송
  - 저장: CloudWatch Logs에 로그를 저장하도록 설정
  - 모니터링: 메트릭 티렉터리를 설정하고 CloudWatch 사용자 메트릭을 생성하여 그 메트릭의 경보를 생성
  - 시각화: CloudWatch의 Logs Insights를 사용하여 대상 로그를 분석하고 CloudWatch의 대시보드로 시각화
- 원래 애플리케이션 로그는 어디에 저장해야 하는가
  - 기존에 WAS 형태는 물리적인 서버에 저장하여 보지만 쿠버네티스 환경에서는 확인하기 어렵다
  - kubectl logs <파드 이름> or kubectl -l app=backend-app과 같은 방법으로 파드의 로그를 참조할 수 있다.
- 로그 수집: EC2에 CloudWatch 에이전트를 설치하고 수집 대상 로그 파일을 설정하면 AWS 로그 저장 공간으로 전송할 있다.
  - 데이터 노드의 IAM 역할에 정책 추가
    - AWA Amazon EC2를 선택해 접속
    - 인스턴스 메뉴를 선택한 후 데이터 노드에 해당하는 인스턴스 ID를 클릭하고 상세 정보 페이지에 IAM 역할 아래 링크 클릭
    - IAM 역할에 정책 연결 버튼 클릭
    - 정책 이름 목록에서 CloudWatchAgentServerPolicy를 선택하여 정책연결 클릭
  - CloudWatch용 네임스페이스 생성
  - 플루언트디 컨테이너를 데몬셋으로 동작시키기
- 로그 저장
  - 기본적으로 기간 제한 없이 저장되며 로그 용량에 따라 과금 발생
  - CloudWatch Logs 보관 기간 설정 필요
    - 로그 그룹 단위로 로그 저장 기간을 설정할 수 있다.
    - application, host, dataplane 단위로 설정할 수 있다.
- 로그 모니터링
  - CloudWatch 경보를 사용한 통지
    - 에러 로그를 추출하고 CloudWatch 메트릭으로 등록해 경보를 생성하면 통지를 보낼 수 있다.
      - 매트릭 필터 조건을 'ERROR'로 설정하고 출력 회수를 매트릭에 등록
      - 출력 회수 매트릭 통보 생성(5분간 1회 이상 발생하면 통지 등)
    - 매트릭 필터에 애플리케이션을 별도로 설정할 수 있다.
      - 이 방법은 사용자 매트릭이 증가하여 비용이 추가 발생한다.
- 로그의 시각화와 분석
  - CloudWatch Logs에 저장된 로그를 검색하고 시각화하는 기능은 CloudWatch Logs Insights 제공

#### 오토스케일링

#### 보안

#### 매니페스트 관리와 CI/CD

#### 버전 관리

#### 파게이트

#### 쿠버네티스를 지탱하는 에코시스템
